<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Submit Form Data to Salesforce</title>
    <style> 
      input[type=text],input[type=email] {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      box-sizing: border-box;
      border: 2px solid red;
      border-radius: 4px;
}
      .custom-select {
  min-width: 350px;
  position: relative;
}

select {
  appearance: none;
  /*  safari  */
  -webkit-appearance: none;
  /*  other styles for aesthetics */
  width: 100%;
  font-size: 1.15rem;
  padding: 0.675em 6em 0.675em 1em;
  background-color: #fff;
  border: 1px solid #caced1;
  border-radius: 0.25rem;
  color: #000;
  cursor: pointer;
}

.custom-select::before,
.custom-select::after {
  --size: 0.3rem;
  content: "";
  position: absolute;
  right: 1rem;
  pointer-events: none;
}

.custom-select::before {
  border-left: var(--size) solid transparent;
  border-right: var(--size) solid transparent;
  border-bottom: var(--size) solid black;
  top: 40%;
}

.custom-select::after {
  border-left: var(--size) solid transparent;
  border-right: var(--size) solid transparent;
  border-top: var(--size) solid black;
  top: 55%;
}


/*=============
Aesthetics 
=========================*/

* {
  box-sizing: border-box;
}
      .button {
  background-color: #04AA6D; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
.button4 {
  background-color: white;
  color: black;
  border: 2px solid #e7e7e7;
}
  .f{
    font-family: "Lucida Console", "Courier New", monospace;

  }
</style>
  </head>
  <body>
    <h1 class="f">Apply For Job Now</h1>
    <form id="salesforceForm">
      <label for="fname" class="f">First Name:</label>
      <input type="text" id="fname" name="firstName" required /><br /><br />
      <label for="lname" class="f">Last Name:</label>
      <input type="text" id="lname" name="lastName" required /><br /><br />


      
      <label for="position" class="f">Position:</label>
      <div class="custom-select">
      <select id="recordDropdown">
        <!-- Dropdown options will be populated dynamically -->
      </select>
      </div>
      <br /><br />
      <label for="resume" class="f">Resume:</label>
    <input type="file" id="resume"  accept=".pdf, .doc, .docx" required /><br /><br />
      <button class="button button4" type="submit">Submit</button>
    </form>

    <script>
      document
        .getElementById("salesforceForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          //  const formData = new FormData(this);
          //  const data = {};
          //  formData.forEach((value, key) => {
          //    data[key] = value;
          //  });
          // const dropdown = document.getElementById("recordDropdown");
          // const selectedRecordId = dropdown.options[dropdown.selectedIndex].value;
          // data["selectedRecordId"] = selectedRecordId;
          // data["email"]=localStorage.getItem("emailId");
          // const resumeFileInput = document.getElementById("resume");
          // const resumeFile = resumeFileInput.files[0];
          // data["resume"]=resumeFile;
          


const fileInput = document.getElementById("resume");
          const file = fileInput.files[0];
var reader = new FileReader();
           reader.onload = function(event) {
                var fileContent = event.target.result;
            const resumeData = fileContent.split(',')[1];
            // const sanitizedData = sanitizeBase64(fileContent);
             const resumeData = btoa(sanitizedData);

             console.log("file data is",resumeData);
                const formData = {
        firstName: document.getElementById("fname").value,
        lastName: document.getElementById("lname").value,
        selectedRecordId: document.getElementById("recordDropdown").value,
        email: localStorage.getItem("emailId"),
        resume: resumeData,
        fileName: file.name
    };
            // const accessToken = "00D5g00000LOawI!ARsAQIymWGX_NTqnKFSunnt_qqSKlh510OkFd7f_dABFLrwebPWvGjziJJR7YtC6WA181JDX1AaRqnCP9oKbdUVKnsXajYJC";
                
            
        


// reader.onload = function(event) {
//     console.log(reader.result);
//   };// Extract base64 data
// reader.readAsBinaryString(fileInput.files[0]);
//reader.readAsDataURL(file);

    // Create a JSON object with all form data including the base64-encoded file content
   
  const accessToken = "00D5g00000LOawI!ARsAQIymWGX_NTqnKFSunnt_qqSKlh510OkFd7f_dABFLrwebPWvGjziJJR7YtC6WA181JDX1AaRqnCP9oKbdUVKnsXajYJC";

    // Send the formData object as JSON to the server
    fetch("https://kriittechnologies2-dev-ed.develop.my.salesforce.com/services/apexrest/submitCandidateData", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${accessToken}`
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        // Handle response
    })
    .catch(error => {
        console.error('Error:', error);
    });
};
            reader.readAsText(file);

          });

      
      function populateDropdown() {
            fetch('https://kriittechnologies2-dev-ed.develop.my.salesforce.com/services/apexrest/submitCandidateData', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer 00D5g00000LOawI!ARsAQIymWGX_NTqnKFSunnt_qqSKlh510OkFd7f_dABFLrwebPWvGjziJJR7YtC6WA181JDX1AaRqnCP9oKbdUVKnsXajYJC'
                }
            })
            .then(response => response.json())
            .then(data => {
                const dropdown = document.getElementById('recordDropdown');
                data.forEach(record => {
                    
                  if(record.Status__c=="Open - Approved"){
                      const option = document.createElement('option');
                      option.value = record.Id;
                      option.textContent = record.Name;
                      dropdown.appendChild(option);
                      console.log("Valid Status is ",record.Status__c);
                  }else{
                    console.log("Not Valid for Post");
                  }
                                 
                });
              console.log("Retrived Data",data);
              console.log();
            })
            .catch(error => {
                console.error('Error fetching data from Salesforce:', error);
            });
        }

        // Call the function to populate the dropdown when the page loads
        populateDropdown();
//       function sanitizeBase64(data) {
//     // Regular expression to match non-base64 characters
//     const regex = /[^A-Za-z0-9+/=]/g;
//     // Remove non-base64 characters from the data
//     return data.replace(regex, '');
// }
    </script>
  </body>
</html>
