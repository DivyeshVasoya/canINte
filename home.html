<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Submit Form Data to Salesforce</title>
    <style> 
      input[type=text],input[type=email] {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      box-sizing: border-box;
      border: 2px solid red;
      border-radius: 4px;
}
      .custom-select {
  min-width: 350px;
  position: relative;
}

select {
  appearance: none;
  /*  safari  */
  -webkit-appearance: none;
  /*  other styles for aesthetics */
  width: 100%;
  font-size: 1.15rem;
  padding: 0.675em 6em 0.675em 1em;
  background-color: #fff;
  border: 1px solid #caced1;
  border-radius: 0.25rem;
  color: #000;
  cursor: pointer;
}

.custom-select::before,
.custom-select::after {
  --size: 0.3rem;
  content: "";
  position: absolute;
  right: 1rem;
  pointer-events: none;
}

.custom-select::before {
  border-left: var(--size) solid transparent;
  border-right: var(--size) solid transparent;
  border-bottom: var(--size) solid black;
  top: 40%;
}

.custom-select::after {
  border-left: var(--size) solid transparent;
  border-right: var(--size) solid transparent;
  border-top: var(--size) solid black;
  top: 55%;
}


/*=============
Aesthetics 
=========================*/

* {
  box-sizing: border-box;
}
      .button {
  background-color: #04AA6D; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
.button4 {
  background-color: white;
  color: black;
  border: 2px solid #e7e7e7;
}
  .f{
    font-family: "Lucida Console", "Courier New", monospace;

  }
</style>
  </head>
  <body>
    <h1 class="f">Apply For Job Now</h1>
    <form id="salesforceForm">
      <label for="fname" class="f">First Name:</label>
      <input type="text" id="fname" name="firstName" required /><br /><br />
      <label for="lname" class="f">Last Name:</label>
      <input type="text" id="lname" name="lastName" required /><br /><br />


      
      <label for="position" class="f">Position:</label>
      <div class="custom-select">
      <select id="recordDropdown">
        <!-- Dropdown options will be populated dynamically -->
      </select>
      </div>
      <br /><br />
      <label for="resume" class="f">Resume:</label>
    <input type="file" id="resume"  accept=".pdf, .doc, .docx" required /><br /><br />
      <button class="button button4" type="submit">Submit</button>
    </form>

    <script>
      document
        .getElementById("salesforceForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          //  const formData = new FormData(this);
          //  const data = {};
          //  formData.forEach((value, key) => {
          //    data[key] = value;
          //  });
          // const dropdown = document.getElementById("recordDropdown");
          // const selectedRecordId = dropdown.options[dropdown.selectedIndex].value;
          // data["selectedRecordId"] = selectedRecordId;
          // data["email"]=localStorage.getItem("emailId");
          // const resumeFileInput = document.getElementById("resume");
          // const resumeFile = resumeFileInput.files[0];
          // data["resume"]=resumeFile;
          
          // console.log("This is actual data",data);
          
    const formData = new FormData(this);
    const dropdown = document.getElementById("recordDropdown");
    const selectedRecordId = dropdown.options[dropdown.selectedIndex].value;

    // Retrieve first name and last name fields
    const firstName = document.getElementById("fname").value;
    const lastName = document.getElementById("lname").value;

    // Add first name and last name to the formData
    formData.append("firstName", firstName);
    formData.append("lastName", lastName);
    
    formData.append("selectedRecordId", selectedRecordId);
    formData.append("email", localStorage.getItem("emailId"));

    // Retrieve the file input element
   const resumeFileInput = document.getElementById("resume");
    const resumeFile = resumeFileInput.files[0]; // Get the selected file
    // Append the file to the FormData object
     if (resumeFile) {
      formData.append("resume", resumeFile);
       console.log("resume is ",resume);
    } else {
        alert("Please select a resume file.");
     return; // Stop further execution if no file is selected
    }
          const reader = new FileReader();
    reader.onload = function(event) {
        const resumeData = event.target.result.split(',')[1]; // Extract base64 data
        formData.append("resume", resumeData);
        sendFormData(formData);
    };
    reader.readAsDataURL(resumeFile);

    // console.log("This is actual data", formData);

          const accessToken =
            "00D5g00000LOawI!ARsAQJjFVGcbZM6vMnTKUPcoYvOVSl.oozHxLwmaDRVdgVdSrHVgefz7wDGJlDs_4d7wgyEydGNHtS8NTemJnef2SHSbDYaU"; // Replace with your access token

          fetch(
            "https://kriittechnologies2-dev-ed.develop.my.salesforce.com/services/apexrest/submitCandidateData",
            {
              method: "POST",
              headers: {
                
                Authorization: `Bearer ${accessToken}`,
              },
              body: JSON.stringify(Object.fromEntries(formData.entries())),
            }
          )
            .then((response) => {
              // if (!response.ok) {
              //   throw new Error("Network response was not ok");
              // }
              return response.text();
            })
            .then((result) => {
              console.log("Form data submitted successfully:", result);
              alert("Form data submitted successfully!");
            })
            .catch((error) => {
              console.error("There was a problem with the request:", error);
              alert("There was a problem submitting the form data.");
            });
        });

      
      function populateDropdown() {
            fetch('https://kriittechnologies2-dev-ed.develop.my.salesforce.com/services/apexrest/submitCandidateData', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer 00D5g00000LOawI!ARsAQJjFVGcbZM6vMnTKUPcoYvOVSl.oozHxLwmaDRVdgVdSrHVgefz7wDGJlDs_4d7wgyEydGNHtS8NTemJnef2SHSbDYaU'
                }
            })
            .then(response => response.json())
            .then(data => {
                const dropdown = document.getElementById('recordDropdown');
                data.forEach(record => {
                    
                  if(record.Status__c=="Open - Approved"){
                      const option = document.createElement('option');
                      option.value = record.Id;
                      option.textContent = record.Name;
                      dropdown.appendChild(option);
                      console.log("Valid Status is ",record.Status__c);
                  }else{
                    console.log("Not Valid for Post");
                  }
                                 
                });
              console.log("Retrived Data",data);
              console.log();
            })
            .catch(error => {
                console.error('Error fetching data from Salesforce:', error);
            });
        }

        // Call the function to populate the dropdown when the page loads
        populateDropdown();
    </script>
  </body>
</html>
